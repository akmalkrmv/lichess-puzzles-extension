{
  "version": 3,
  "sources": ["../../src/models/storm.model.ts", "../../src/utils/random.util.ts", "../../src/content/content_storm.ts"],
  "sourcesContent": ["import {PuzzleId} from './common.js';\r\n\r\nexport type StormId = string;\r\nexport type StormPuzzles = Pick<IStorm, 'solved' | 'unsolved' | 'reviewed'>;\r\nexport type StormStats = Pick<IStorm, 'score' | 'moves' | 'accuracy' | 'combo' | 'time' | 'timePerMove' | 'highestSolved'>;\r\n\r\nexport interface IStorm {\r\n  stormId: StormId;\r\n  timestamp: number;\r\n\r\n  // puzzles\r\n  solved: PuzzleId[];\r\n  unsolved: PuzzleId[];\r\n  reviewed: PuzzleId[];\r\n\r\n  // stats\r\n  score: number;\r\n  moves: number;\r\n  accuracy: number;\r\n  combo: number;\r\n  time: number;\r\n  timePerMove: number;\r\n  highestSolved: number;\r\n}\r\n\r\nexport class Storm implements IStorm {\r\n  public timestamp: number = Date.now();\r\n\r\n  // stats\r\n  public score: number = 0;\r\n  public moves: number = 0;\r\n  public accuracy: number = 0;\r\n  public combo: number = 0;\r\n  public time: number = 0;\r\n  public timePerMove: number = 0;\r\n  public highestSolved: number = 0;\r\n\r\n  // puzzles\r\n  public solved: PuzzleId[] = [];\r\n  public unsolved: PuzzleId[] = [];\r\n  public reviewed: PuzzleId[] = [];\r\n\r\n  constructor(public stormId: StormId) {}\r\n\r\n  public setStats({score, moves, accuracy, combo, time, timePerMove, highestSolved}: StormStats): Storm {\r\n    this.score = score || 0;\r\n    this.moves = moves || 0;\r\n    this.accuracy = accuracy || 0;\r\n    this.combo = combo || 0;\r\n    this.time = time || 0;\r\n    this.timePerMove = timePerMove || 0;\r\n    this.highestSolved = highestSolved || 0;\r\n    return this;\r\n  }\r\n\r\n  public setPuzzles({solved, unsolved, reviewed}: StormPuzzles): Storm {\r\n    this.solved = solved || [];\r\n    this.unsolved = unsolved || [];\r\n    this.reviewed = reviewed || [];\r\n    return this;\r\n  }\r\n}\r\n", "export function generateRandomUIDString() {\r\n  const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n  let randomString: string = '';\r\n\r\n  for (let i: number = 0; i < 5; i++) {\r\n    const randomIndex: number = Math.floor(Math.random() * characters.length);\r\n    randomString += characters[randomIndex];\r\n  }\r\n\r\n  return randomString;\r\n}\r\n", "// Example href link of storm run\r\n// https://lichess.org/storm\r\n\r\nimport {Storm} from '../models';\r\nimport {MessageTypes} from '../messages';\r\nimport {generateRandomUIDString} from '../utils/random.util';\r\n\r\n(function () {\r\n  const SELECTORS = {\r\n    history: '.puz-history',\r\n    score: '.storm--end__score__number',\r\n    stats: '.slist td number',\r\n    solvedRounds: '.puz-history__round:has(good) a',\r\n    unsolvedRounds: '.puz-history__round:has(bad) a',\r\n  } as const;\r\n\r\n  const getText = (selector: string) => document.querySelector(selector)?.textContent || undefined;\r\n  const getLinks = (selector: string) => [...document.querySelectorAll(selector)].map((a: Element) => (a as HTMLAnchorElement).href);\r\n  const extractStats = (): number[] => [...document.querySelectorAll(SELECTORS.stats)].map((el: Element) => Number(el.textContent || 0));\r\n  const extractLastSegment = (href: string) => href.split('/').pop()!;\r\n\r\n  function collectPuzzles() {\r\n    const score: number = Number(getText(SELECTORS.score) ?? 0);\r\n    const solved: string[] = getLinks(SELECTORS.solvedRounds).map(extractLastSegment);\r\n    const unsolved: string[] = getLinks(SELECTORS.unsolvedRounds).map(extractLastSegment);\r\n    const reviewed: string[] = [];\r\n    const [moves, accuracy, combo, time, timePerMove, highestSolved] = extractStats();\r\n\r\n    // Ignore probable Idle\r\n    if (unsolved.length <= 1 && solved.length === 0) return;\r\n\r\n    const newStorm: Storm = new Storm(generateRandomUIDString());\r\n    newStorm.setStats({score, moves, accuracy, combo, time, timePerMove, highestSolved});\r\n    newStorm.setPuzzles({solved, unsolved, reviewed});\r\n\r\n    chrome.runtime.sendMessage({\r\n      type: MessageTypes.puzzle_storm_finished,\r\n      ...newStorm,\r\n    });\r\n  }\r\n\r\n  // The history list appears when race ends.\r\n  // Use MutationObserver so it works reliably.\r\n\r\n  const observer = new MutationObserver(() => {\r\n    const history: Element | null = document.querySelector(SELECTORS.history);\r\n    if (history) {\r\n      collectPuzzles();\r\n      observer.disconnect();\r\n    }\r\n  });\r\n\r\n  observer.observe(document.body, {childList: true, subtree: true});\r\n})();\r\n"],
  "mappings": ";;;AAyBO,MAAM,QAAN,MAA8B;AAAA,IAiBnC,YAAmB,SAAkB;AAAlB;AAhBnB,WAAO,YAAoB,KAAK,IAAI;AAGpC;AAAA,WAAO,QAAgB;AACvB,WAAO,QAAgB;AACvB,WAAO,WAAmB;AAC1B,WAAO,QAAgB;AACvB,WAAO,OAAe;AACtB,WAAO,cAAsB;AAC7B,WAAO,gBAAwB;AAG/B;AAAA,WAAO,SAAqB,CAAC;AAC7B,WAAO,WAAuB,CAAC;AAC/B,WAAO,WAAuB,CAAC;AAAA,IAEO;AAAA,IAE/B,SAAS,EAAC,OAAO,OAAO,UAAU,OAAO,MAAM,aAAa,cAAa,GAAsB;AACpG,WAAK,QAAQ,SAAS;AACtB,WAAK,QAAQ,SAAS;AACtB,WAAK,WAAW,YAAY;AAC5B,WAAK,QAAQ,SAAS;AACtB,WAAK,OAAO,QAAQ;AACpB,WAAK,cAAc,eAAe;AAClC,WAAK,gBAAgB,iBAAiB;AACtC,aAAO;AAAA,IACT;AAAA,IAEO,WAAW,EAAC,QAAQ,UAAU,SAAQ,GAAwB;AACnE,WAAK,SAAS,UAAU,CAAC;AACzB,WAAK,WAAW,YAAY,CAAC;AAC7B,WAAK,WAAW,YAAY,CAAC;AAC7B,aAAO;AAAA,IACT;AAAA,EACF;;;AC7DO,WAAS,0BAA0B;AACxC,UAAM,aAAa;AACnB,QAAI,eAAuB;AAE3B,aAAS,IAAY,GAAG,IAAI,GAAG,KAAK;AAClC,YAAM,cAAsB,KAAK,MAAM,KAAK,OAAO,IAAI,WAAW,MAAM;AACxE,sBAAgB,WAAW,WAAW;AAAA,IACxC;AAEA,WAAO;AAAA,EACT;;;ACHA,GAAC,WAAY;AACX,UAAM,YAAY;AAAA,MAChB,SAAS;AAAA,MACT,OAAO;AAAA,MACP,OAAO;AAAA,MACP,cAAc;AAAA,MACd,gBAAgB;AAAA,IAClB;AAEA,UAAM,UAAU,CAAC,aAAqB,SAAS,cAAc,QAAQ,GAAG,eAAe;AACvF,UAAM,WAAW,CAAC,aAAqB,CAAC,GAAG,SAAS,iBAAiB,QAAQ,CAAC,EAAE,IAAI,CAAC,MAAgB,EAAwB,IAAI;AACjI,UAAM,eAAe,MAAgB,CAAC,GAAG,SAAS,iBAAiB,UAAU,KAAK,CAAC,EAAE,IAAI,CAAC,OAAgB,OAAO,GAAG,eAAe,CAAC,CAAC;AACrI,UAAM,qBAAqB,CAAC,SAAiB,KAAK,MAAM,GAAG,EAAE,IAAI;AAEjE,aAAS,iBAAiB;AACxB,YAAM,QAAgB,OAAO,QAAQ,UAAU,KAAK,KAAK,CAAC;AAC1D,YAAM,SAAmB,SAAS,UAAU,YAAY,EAAE,IAAI,kBAAkB;AAChF,YAAM,WAAqB,SAAS,UAAU,cAAc,EAAE,IAAI,kBAAkB;AACpF,YAAM,WAAqB,CAAC;AAC5B,YAAM,CAAC,OAAO,UAAU,OAAO,MAAM,aAAa,aAAa,IAAI,aAAa;AAGhF,UAAI,SAAS,UAAU,KAAK,OAAO,WAAW,EAAG;AAEjD,YAAM,WAAkB,IAAI,MAAM,wBAAwB,CAAC;AAC3D,eAAS,SAAS,EAAC,OAAO,OAAO,UAAU,OAAO,MAAM,aAAa,cAAa,CAAC;AACnF,eAAS,WAAW,EAAC,QAAQ,UAAU,SAAQ,CAAC;AAEhD,aAAO,QAAQ,YAAY;AAAA,QACzB;AAAA,QACA,GAAG;AAAA,MACL,CAAC;AAAA,IACH;AAKA,UAAM,WAAW,IAAI,iBAAiB,MAAM;AAC1C,YAAM,UAA0B,SAAS,cAAc,UAAU,OAAO;AACxE,UAAI,SAAS;AACX,uBAAe;AACf,iBAAS,WAAW;AAAA,MACtB;AAAA,IACF,CAAC;AAED,aAAS,QAAQ,SAAS,MAAM,EAAC,WAAW,MAAM,SAAS,KAAI,CAAC;AAAA,EAClE,GAAG;",
  "names": []
}
