{
  "version": 3,
  "sources": ["../../src/UI/selectors.ts", "../../src/content/content_training.ts"],
  "sourcesContent": ["export const PUZZLE_FEEDBACK_SELECTOR = '.puzzle__feedback';\r\n\r\nexport const PUZZLE_FEEDBACK_SUCCESS_SELECTOR = `${PUZZLE_FEEDBACK_SELECTOR} .complete`;\r\nexport const PUZZLE_FEEDBACK_FAIL_SELECTOR = `${PUZZLE_FEEDBACK_SELECTOR} .fail`;\r\nexport const PUZZLE_FEEDBACK_NEXT_SELECTOR = `${PUZZLE_FEEDBACK_SELECTOR} .puzzle__more`;\r\n\r\nexport const SELECTORS = {\r\n  RACER_PAGE: {\r\n    score: '.puz-side__solved__text',\r\n    rank: '.race__post__rank',\r\n    solvedRounds: '.puz-history__round:has(good) a',\r\n    unsolvedRounds: '.puz-history__round:has(bad) a',\r\n  },\r\n  STORM_PAGE: {\r\n    score: '.storm--end__score__number',\r\n    solvedRounds: '.puz-history__round:has(good) a',\r\n    unsolvedRounds: '.puz-history__round:has(bad) a',\r\n    stats: '.slist td number',\r\n  },\r\n};\r\n", "// Example href link of single puzzle\r\n// https://lichess.org/training/Iy8iI\r\n\r\nimport {MessageTypes} from '../messages';\r\nimport {Race, PuzzleId} from '../models';\r\nimport {PUZZLE_FEEDBACK_SUCCESS_SELECTOR, PUZZLE_FEEDBACK_NEXT_SELECTOR} from '../UI/selectors';\r\n\r\ntype RacesRecord = Record<string, Race>;\r\ntype PuzzleLink = string | undefined;\r\n\r\n(function () {\r\n  const PUZZLE_TRAINING = 'https://lichess.org/training';\r\n\r\n  // Extract puzzle ID (last path segment)\r\n  const puzzleId: PuzzleId | undefined = location.pathname.split('/').pop(); // e.g. \"Iy8iI\"\r\n\r\n  // Observe dynamic DOM\r\n  const observer = new MutationObserver(() => checkIfPuzzleSolved());\r\n  observer.observe(document.body, {childList: true, subtree: true});\r\n\r\n  const DATE_RANGES = {\r\n    today: {label: 'Today', offset: 0},\r\n    yesterday: {label: 'Yesterday', offset: 1},\r\n    week: {label: 'Last 7 days', offset: 7},\r\n    month: {label: 'Last 30 days', offset: 30},\r\n    all: {label: 'All time', offset: Infinity},\r\n  } as const;\r\n\r\n  type DateRange = keyof typeof DATE_RANGES;\r\n\r\n  function getDateRangeFilter(range: DateRange) {\r\n    const offset = DATE_RANGES[range]?.offset;\r\n    if (offset === undefined) return null;\r\n\r\n    // Create today at midnight\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n\r\n    // Calculate cutoff date at midnight\r\n    const cutoffDate = new Date(today);\r\n    cutoffDate.setDate(cutoffDate.getDate() - offset);\r\n\r\n    return (timestamp: number) => {\r\n      if (offset === Infinity) return true;\r\n      const raceDate = new Date(timestamp);\r\n      raceDate.setHours(0, 0, 0, 0);\r\n      return raceDate >= cutoffDate;\r\n    };\r\n  }\r\n\r\n  function filterUnsolvedPuzzles(races: RacesRecord, range: DateRange) {\r\n    const filter = getDateRangeFilter(range);\r\n    if (!filter) return [];\r\n\r\n    const puzzles: string[] = [];\r\n    Object.values(races).forEach((race) => {\r\n      if (filter(race.timestamp) && race.unsolved) {\r\n        puzzles.push(...race.unsolved);\r\n      }\r\n    });\r\n\r\n    // Remove duplicates\r\n    return [...new Set(puzzles)];\r\n  }\r\n\r\n  function prependPathIfNeeded(path: string, puzzleLinkOrId: string) {\r\n    return puzzleLinkOrId.startsWith(path) ? puzzleLinkOrId : `${path}/${puzzleLinkOrId}`;\r\n  }\r\n\r\n  function appendNextUnsolvedLink(container: Element, puzzleLink: PuzzleLink, count: number) {\r\n    if (!container) return;\r\n    if (!puzzleLink) return;\r\n\r\n    const link: HTMLAnchorElement = document.createElement('a');\r\n    link.href = prependPathIfNeeded(PUZZLE_TRAINING, puzzleLink);\r\n    link.textContent = `Next Unsolved (${count})`;\r\n    container.appendChild(link);\r\n  }\r\n\r\n  function checkIfPuzzleSolved() {\r\n    const isPuzzleSolved = document.querySelector(PUZZLE_FEEDBACK_SUCCESS_SELECTOR);\r\n    if (!isPuzzleSolved) return;\r\n\r\n    chrome.runtime.sendMessage({type: MessageTypes.puzzle_solved_single, id: puzzleId});\r\n\r\n    // Optional: auto-close puzzle tab after solving\r\n    // chrome.runtime.sendMessage({ type: \"close_tab\" });\r\n\r\n    const nextPuzzleContainer = document.querySelector(PUZZLE_FEEDBACK_NEXT_SELECTOR);\r\n    if (!nextPuzzleContainer) {\r\n      return;\r\n    }\r\n\r\n    // TODO: Use repository to get unsolved puzzles\r\n    chrome.storage.local.get(['races'], (data) => {\r\n      const races: RacesRecord = (data.races as RacesRecord) || {};\r\n      const unsolvedPuzzles: PuzzleLink[] = filterUnsolvedPuzzles(races, 'today')\r\n        .map((link: string) => link.split('/').pop())\r\n        .filter((id: PuzzleLink) => id !== puzzleId);\r\n\r\n      if (!unsolvedPuzzles?.length) return;\r\n\r\n      const remaining: number = unsolvedPuzzles.length;\r\n      const nextUnsolvedPuzzleLink: PuzzleLink = unsolvedPuzzles.pop();\r\n\r\n      appendNextUnsolvedLink(nextPuzzleContainer, nextUnsolvedPuzzleLink, remaining);\r\n    });\r\n\r\n    observer.disconnect();\r\n\r\n    return;\r\n  }\r\n\r\n  // Also check once on load (in case feedback appears instantly)\r\n  checkIfPuzzleSolved();\r\n})();\r\n"],
  "mappings": "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",
  "names": []
}
